# OpenMeteo API Service

Сервис для сбора данных о погоде и состоянии почвы из [Open-Meteo Archive API](https://open-meteo.com/) по координатам метеостанций.

## Описание

Данный сервис дополняет существующую систему сбора данных с метеостанций ([weatherInTheField](https://github.com/memrook/weatherInTheField)) информацией из внешнего источника Open-Meteo для сравнительного анализа. Сервис:

1. Находит все координаты в таблице со списком метеостанций
2. Опрашивает сервис Archive OpenMeteo API по каждым координатам из таблицы метеостанций 
3. Загружает данные за предыдущие 365 дней (по умолчанию)
4. Выполняет ежедневное обновление новых данных

## Параметры сбора данных

Сервис собирает следующие метеорологические и почвенные параметры:

- Temperature 2m (°C)
- Relative Humidity 2m (%)
- Rain (mm)
- Wind Speed 10m (km/h)
- Wind Direction 10m (°)
- Precipitation (mm)
- Soil Temperature 0-7cm, 7-28cm (°C)
- Soil Moisture 0-7cm, 7-28cm (m³/m³)

## Установка и настройка

### Предварительные требования

- Go 1.21 или новее
- Доступ к MS SQL Server

### Конфигурация

1. Создайте файл `.env` в корневой директории проекта (можно скопировать из `.env.example`):

```
# Данные для подключения к базе данных
DB_SERVER=ваш_сервер
DB_LOGIN=ваш_логин
DB_PASSWORD=ваш_пароль
DB_NAME=WeatherData

# Интервал сбора данных в минутах (по умолчанию раз в день - 1440 минут)
COLLECTION_INTERVAL=1440

# Количество дней для предыдущих данных (по умолчанию 365 дней)
PAST_DAYS=365
```

### Сборка

```sh
go build -o openmeteo-service ./cmd/openmeteo
```

### Запуск

```sh
./openmeteo-service
```

## Работа с данными

Данные сохраняются в таблицу `OpenMeteoTelemetry` в базе данных:

- `StationID` - ID метеостанции
- `SensorKey` - Ключ датчика (например, openmeteo_temperature)
- `Timestamp` - Временная метка в миллисекундах
- `DateValue` - Дата и время измерения
- `Value` - Значение измерения

## Структура проекта

```
openMeteoAPI/
├── cmd/
│   └── openmeteo/       # Код исполняемого файла сервиса
├── pkg/
│   ├── api/             # Код для работы с Open-Meteo API
│   ├── config/          # Конфигурация приложения
│   └── database/        # Код для работы с базой данных
├── .env.example         # Пример файла окружения
├── go.mod               # Описание модуля Go
└── README.md            # Текущий файл
```

## Периодичность работы

По умолчанию, сервис запускает сбор данных раз в день. Это можно изменить, установив параметр `COLLECTION_INTERVAL` в файле `.env`.

## Лицензия

[MIT License](LICENSE) 